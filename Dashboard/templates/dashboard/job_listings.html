{% extends 'base.html' %}

{% block content %}

<!-- Job List Area Start -->
<div class="job-listing-area pt-120 pb-120">
    <div class="container">
        <div class="row">
            <!-- Left Filter Column -->
            <div class="col-xl-3 col-lg-3 col-md-4">
                <div class="row">
                    <div class="col-12">
                        <div class="small-section-tittle2 mb-45">
                            <div class="ion">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="12px">
                                    <path fill-rule="evenodd" fill="rgb(27, 207, 107)"
                                        d="M7.778,12.000 L12.222,12.000 L12.222,10.000 L7.778,10.000 L7.778,12.000 ZM-0.000,-0.000 L-0.000,2.000 L20.000,2.000 L20.000,-0.000 L-0.000,-0.000 ZM3.333,7.000 L16.667,7.000 L16.667,5.000 L3.333,5.000 L3.333,7.000 Z"/>
                                </svg>
                            </div>
                            <h4>Filter Jobs</h4>
                        </div>
                    </div>
                </div>

                <!-- Job Category & Type Filters -->
                <div class="job-category-listing mb-50">
                    <form action="{% url 'dashboard:job_listings' %}" method="get">
                        <div class="single-listing">
                            <div class="small-section-tittle2">
                                <h4>Job Category</h4>
                            </div>
                            <div class="select-job-items2">
                                <select name="category" onchange="this.form.submit()">
                                    <option value="">All Categories</option>
                                    {% for cat in categories %}
                                    <option value="{{ cat }}" {% if selected_category == cat %}selected{% endif %}>{{ cat }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="select-Categories pt-20 pb-50">
                                <div class="small-section-tittle2">
                                    <h4>Job Type</h4>
                                </div>
                                <label class="container">Full Time
                                    <input type="checkbox" name="job_type" value="Full Time"
                                        {% if 'Full Time' in selected_job_types %}checked{% endif %}>
                                    <span class="checkmark"></span>
                                </label>
                                <label class="container">Part Time
                                    <input type="checkbox" name="job_type" value="Part Time"
                                        {% if 'Part Time' in selected_job_types %}checked{% endif %}>
                                    <span class="checkmark"></span>
                                </label>
                                <label class="container">Remote
                                    <input type="checkbox" name="job_type" value="Remote"
                                        {% if 'Remote' in selected_job_types %}checked{% endif %}>
                                    <span class="checkmark"></span>
                                </label>
                                <label class="container">Freelance
                                    <input type="checkbox" name="job_type" value="Freelance"
                                        {% if 'Freelance' in selected_job_types %}checked{% endif %}>
                                    <span class="checkmark"></span>
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Right Jobs Column -->
            <div class="col-xl-9 col-lg-9 col-md-8">
                <div class="row justify-content-center mb-16 ">
                    <div class="col-lg-8 text-center font-semibold">
                        <span>{{ page_obj.paginator.count }} jobs found</span>
                    </div>
                </div>

                <div class="row g-4 align-items-stretch">
                    {% if page_obj %}
                        {% for job in page_obj %}
                        <div class="col-lg-6 col-md-12">
                            <div class="single-job-items mb-4 p-3 border rounded shadow-sm d-flex flex-column h-100">
                                <div class="d-flex justify-content-between align-items-start flex-grow-1">
                                    <!-- Left Job Info -->
                                    <div class="job-tittle">
                                        <a href="{% url 'item:detail' job.id %}">
                                            <h4 class="mb-1">{{ job.job_position }}</h4>
                                        </a>
                                        <ul class="list-inline mb-0 small text-muted">
                                            <li class="list-inline-item">{{ job.company_name }}</li>
                                            {% if job.salary %}
                                            <li class="list-inline-item">R{{ job.salary }}</li>
                                            {% endif %}
                                            {% if job.location %}
                                            <li class="list-inline-item">{{ job.location }}</li>
                                            {% endif %}
                                            <li class="list-inline-item"><i class="fas fa-calendar-alt"></i> {{ job.date_posted|date:"F j, Y" }}</li>
                                            <li class="list-inline-item">{{ job.job_nature }}</li>
                                        </ul>
                                    </div>

                                    <!-- Right Button -->
                                    <div class="ms-auto text-end mt-3 mt-md-0">
                                        <a href="{% url 'item:detail' job.id %}" class="btn btn-primary btn-sm">View Details</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center mt-5">
                            <p>No jobs found.</p>
                        </div>
                    {% endif %}
                </div>

                <!-- Pagination controls -->
                <div class="row">
                    <div class="col-12 d-flex justify-content-center mt-20">
                        <nav class="me-80">
                            <ul class="pagination">
                                {% if page_obj.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                                {% else %}
                                <li class="page-item disabled">
                                    <span class="page-link">&laquo;</span>
                                </li>
                                {% endif %}

                                {% for num in page_obj.paginator.page_range %}
                                    {% if page_obj.number == num %}
                                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                                    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                        <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                                    {% endif %}
                                {% endfor %}

                                {% if page_obj.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                                {% else %}
                                <li class="page-item disabled">
                                    <span class="page-link">&raquo;</span>
                                </li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div>
                </div>
            </div> <!-- End Jobs Column -->
        </div> <!-- End Row -->
    </div> <!-- End Container -->
</div> <!-- Job Listing Area -->

<script>
document.querySelectorAll('form input[type="checkbox"]').forEach(function(el){
    el.addEventListener('change', function(){
        el.closest('form').submit();
    })
})
</script>

{% endblock %}
