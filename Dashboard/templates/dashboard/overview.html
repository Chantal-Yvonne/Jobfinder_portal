{% extends "base.html" %}
{% block title %}Dashboard Overview{% endblock %}

{% block content %}
<h2>Dashboard Overview</h2>

<!-- Jobs posted by you -->
<h3>Your Posted Jobs</h3>
<table class="table table-bordered">
  <thead class="table-dark">
    <tr>
      <th>Job ID</th>
      <th>Company Name</th>
      <th>Job Position</th>
      <th>Description</th>
      <th>Salary</th>
      <th>Date Posted</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% if my_jobs %}
      {% for job in my_jobs %}
        <tr>
          <td>{{ job.id }}</td>
          <td>{{ job.company_name }}</td>
          <td>{{ job.job_position }}</td>
          <td>{{ job.description }}</td>
          <td>{{ job.salary }}</td>
          <td>{{ job.date_posted|date:"F j, Y" }}</td>
          <td>
            <a href="{% url 'dashboard:update' pk=job.id %}" class="btn btn-success btn-sm">Edit</a>
            <form action="{% url 'dashboard:delete' pk=job.id %}" method="POST" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this job?');">Delete</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="7" class="text-center">You haven't posted any jobs yet.</td>
      </tr>
    {% endif %}
  </tbody>
</table>

<!-- Applicants to your jobs -->
<h3>Applicants to Your Jobs</h3>
<table class="table table-bordered">
  <thead class="table-dark">
    <tr>
      <th>Applicant Name</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Motivational Message</th>
      <th>CV</th>
      <th>Job Applied For</th>
    </tr>
  </thead>
  <tbody>
    {% if applicants %}
      {% for app in applicants %}
        <tr>
          <td>{{ app.full_name }}</td>
          <td>{{ app.email }}</td>
          <td>{{ app.phone }}</td>
          <td>{{ app.motivational|linebreaks }}</td>
          <td>
            {% if app.curriculum_vitae %}
              <a href="{{ app.curriculum_vitae.url }}" target="_blank" download>Download CV</a>
            {% else %}
              N/A
            {% endif %}
          </td>
          <td>{{ app.job.job_position }} at {{ app.job.company_name }}</td>
        </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="6" class="text-center">No applicants have applied to your jobs yet.</td>
      </tr>
    {% endif %}
  </tbody>
</table>


<!-- Jobs you've applied to -->
<h3>Jobs You Have Applied To</h3>
<table class="table table-bordered">
  <thead class="table-dark">
    <tr>
      <th>Job Position</th>
      <th>Company Name</th>
      <th>Date Applied</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% if applied_jobs %}
      {% for app in applied_jobs %}
        <tr>
          <td>{{ app.job.job_position }}</td>
          <td>{{ app.job.company_name }}</td>
          <td>{{ app.created_at|date:"F j, Y, g:i a" }}</td>
          <td>
            <a href="{% url 'item:detail' pk=app.job.id %}" class="btn btn-warning btn-sm">Go to Job Detail</a>
            <form action="{% url 'dashboard:delete_application' pk=app.id %}" method="POST" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to withdraw this application?');">Delete Application</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="4" class="text-center">You have not applied to any jobs yet.</td>
      </tr>
    {% endif %}
  </tbody>
</table>

{% endblock %}
